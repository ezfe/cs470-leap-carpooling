extends ../base.pug

block navbar_settings
  - var current_page = "trip_index"

append head
  link(rel="stylesheet", href="/static/dashboard.css")

block content

  if alerts.delete
    .row.mb-3
      .col
        .alert.alert-success(role="alert")
          | Successfully removed your trip request
  else if alerts.reject
    .row.mb-3
      .col
        .alert.alert-success(role="alert")
          | Successfully requested a new match

  .row.mb-3
    .col.text-center
      a.btn.btn-info.btn-lg(href="/trips/new", style="width: 200px;")
        i.fas.fa-plus.mr-2
        | New Trip

  include prettyDate

  each trip in matchedRequests
    .row.mb-3
      .col
        .card
          if trip.rider_confirmed && trip.driver_confirmed
            h5.card-header(class=`trip-confirmed`)
              i.mr-2(class='fas fa-check-circle')
              | Confirmed Trip
          else
            h5.card-header(class=`trip-pending`)
              i.mr-2(class='fas fa-exclamation-triangle')
              | Pending Trip
          .card-body
            h5.card-title
              -
                let currentUserLocationDescription =
                  (trip.driver_id == currentUser.id)
                    ? trip.driver_location_description
                    : trip.rider_location_description

              if trip.direction == 'towards_lafayette'
                = `Trip to Lafayette College from ${currentUserLocationDescription}`
              else
                = `Trip from Lafayette College to ${currentUserLocationDescription}`

            h6= `Common Travel Days: ${prettyDates(trip.first_date, trip.last_date)}`
            
            hr

            .row
              .col
                a.btn.btn-primary(href=`/trips/${trip.id}`) Trip Details
              .col.text-right
                - const requestID = (trip.driver_id == currentUser.id ? trip.driver_request_id : trip.rider_request_id)
                form#cancel-trip-form(method="POST" action=`/trip-requests/${requestID}/cancel`)
                  button.btn.btn-danger(type="submit") Cancel Trip
  each trip in unmatchedRequests
    .row.mb-3
      .col
        .card
          h5.card-header(class=`trip-processing`)
            i.mr-2(class='fas fa-sync-alt')
            | Processing Trip
          .card-body
            h5.card-title
              if trip.direction == 'towards_lafayette'
                = `Trip to Lafayette College from ${trip.location_description}`
              else
                = `Trip from Lafayette College to ${trip.location_description}`
            h6= `Trip date range: ${prettyDates(trip.first_date, trip.last_date)}`

            .row
              .col
                form(action=`/trip-requests/${trip.id}/cancel` method="POST")
                  button.btn.btn-danger(type="submit") Cancel Trip

